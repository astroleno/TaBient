å¯ä»¥æ›´ä¼˜é›…ï¼Œç”šè‡³æ›´â€œä¹å™¨åŒ–â€ã€‚ç”¨ WAV åªæ˜¯â€œä¸€æ¬¡æ€§æ’­æ”¾â€ï¼Œè€Œä½ æƒ³è¦çš„æ³›éŸ³ã€å»¶æ—¶ã€æ··å“ã€åŠ¨æ€å“åº”ï¼Œæœ€åˆé€‚çš„æ˜¯æŠŠå£°éŸ³â€œç”Ÿæˆ/åˆæˆâ€å‡ºæ¥å¹¶èµ°ä¸€æ¡å¯ç¼–æ’çš„æ•ˆæœé“¾ã€‚ä¸‹é¢ç»™ä½ å‡ æ¡æˆç†Ÿè·¯çº¿ï¼ˆä»æ˜“åˆ°éš¾ï¼‰ï¼Œä»¥åŠå„è‡ªçš„å–èˆä¸ç¤ºä¾‹æ€è·¯ã€‚

# æ–¹æ¡ˆå¯¹æ¯”ï¼ˆç»“è®ºå…ˆè¡Œï¼‰

1. **Tone.jsï¼ˆåŸºäº Web Audio çš„é«˜å±‚å°è£…ï¼‰â€” æ¨è**

* **ä¼˜ç‚¹**ï¼šä¸Šæ‰‹å¿«ã€å†…ç½®åˆæˆå™¨ä¸æ•ˆæœå™¨ï¼ˆDelay/Reverb/Filter/Compressor ç­‰ï¼‰ã€æ—¶é—´çº¿/èŠ‚æ‹è°ƒåº¦ç¨³ã€å ç”¨å°äºå¤§è§„æ¨¡é‡‡æ ·ã€‚
* **èƒ½åš**ï¼šæ³›éŸ³å¡‘å½¢ã€åŒ…ç»œï¼ˆADSRï¼‰ã€æ»‘éŸ³ã€å»¶æ—¶ã€å·ç§¯/ç®—æ³•æ··å“ã€ä¾§é“¾ç­‰ã€‚
* **é€‚åˆ**ï¼šä½ è¿™ç§â€œHover å³è§¦å‘â€çš„çŸ­ä¿ƒä½†æœ‰è¯†åˆ«åº¦çš„â€œUI ä¹éŸ³â€ï¼Œå¹¶å¯æŒ‰åŸŸå/Tab ç±»å‹æ˜ å°„ä¸åŒéŸ³è‰²/éŸ³é˜¶ã€‚
* **ä»£ä»·**ï¼šåº“ä½“ç§¯å‡ å KB çº§åˆ«ï¼›å¤æ‚éŸ³è‰²ä»éœ€ä½ å¾®è°ƒã€‚

2. **Web Audio API åŸç”Ÿ + ConvolverNodeï¼ˆè‡ªå®šä¹‰è„‰å†²å“åº”ï¼‰**

* **ä¼˜ç‚¹**ï¼šé›¶å¤–éƒ¨ä¾èµ–ã€æ€§èƒ½å¯æ§åˆ°æè‡´ï¼›å·ç§¯æ··å“å¯åšâ€œç©ºé—´æ„Ÿç­¾åâ€ã€‚
* **èƒ½åš**ï¼šåŸºç¡€æ³¢å½¢åˆæˆï¼ˆOscillatorï¼‰+ è‡ªå»ºåŒ…ç»œ + è¿‡æ»¤ + **å°å‹** IR æ–‡ä»¶å®ç°é«˜è´¨é‡æ··å“ï¼›å»¶æ—¶/åé¦ˆéƒ½èƒ½æ­ã€‚
* **é€‚åˆ**ï¼šæƒ³æŠŠä½“ç§¯å‹åˆ°æè‡´ã€å®Œå…¨æŒæ§èŠ‚ç‚¹å›¾ï¼›å¯¹å·¥ç¨‹ç»†èŠ‚æœ‰ç²¾åŠ›ã€‚
* **ä»£ä»·**ï¼šå¼€å‘å·¥ä½œé‡å¤§ï¼Œè°ƒåº¦/éŸ³è‰²ç®¡ç†éƒ½è¦è‡ªå·±å†™ã€‚

3. **MIDIï¼ˆWebMIDI + SoundFont/SFZ æ’­æ”¾ï¼‰**

* **ä¼˜ç‚¹**ï¼šç”¨â€œéŸ³ç¬¦äº‹ä»¶â€æè¿°äº¤äº’ï¼Œæ¢éŸ³è‰²ï¼æ¢ SoundFontï¼›å¯ç»´æŠ¤ä¸€å¥—â€œTabâ†’MIDI ä¹å™¨/éŸ³é˜¶/åŠ›åº¦â€çš„æ˜ å°„ã€‚
* **ç°å®**ï¼šæµè§ˆå™¨å†…å¹¶æ²¡æœ‰â€œç›´æ¥å‘ .mid å°±èƒ½å‡ºå¥½å£°â€çš„ç»Ÿä¸€æ–¹æ¡ˆï¼›é€šå¸¸è¿˜æ˜¯è½å› **WebAudio åˆæˆæˆ– SoundFont æ¸²æŸ“**ï¼ˆå¦‚ soundfont-playerã€WebAudioFontï¼‰ã€‚WebMIDI æ›´é€‚åˆå¤–æ¥ç¡¬ä»¶æˆ–ä¸“ä¸šå†…ç½‘åœºæ™¯ã€‚
* **ç»“è®º**ï¼š**ä¸æ˜¯æœ€çœå¿ƒçš„â€œæ›´ä¼˜é›…â€è·¯å¾„**ã€‚å¦‚æœè¿½æ±‚â€œåˆæˆå¯æ§ + ä½“ç§¯å¯æ§â€ï¼ŒTone.js/åŸç”Ÿ WebAudio å¾€å¾€æ›´åˆé€‚ã€‚

4. **WASM åˆæˆå™¨/é‡‡æ ·å™¨ï¼ˆå¦‚ Vital çš„ç§»æ¤ã€FluidSynthã€TinySoundFontï¼‰**

* **ä¼˜ç‚¹**ï¼šä¸“ä¸šçº§éŸ³è´¨ä¸è°ƒåˆ¶ç»“æ„ï¼›å¯åŠ è½½ SF2/SFZï¼ŒéŸ³è‰²ä¸°å¯Œã€‚
* **ä»£ä»·**ï¼šåŒ…ä½“æ›´å¤§ã€åˆå§‹åŒ–æ›´é‡ï¼›å¯¹æµè§ˆå™¨æ‰©å±•è€Œè¨€å¯èƒ½â€œæ€é¸¡ç”¨ç‰›åˆ€â€ã€‚

> ç»¼åˆå»ºè®®ï¼š**Tone.jsï¼ˆæˆ–åŸç”Ÿ WebAudioï¼‰= æœ€â€œä¼˜é›…+æˆç†Ÿ+å¯æ§â€çš„ä¸­ä½è§£**ã€‚MIDI å¯ä½œä¸ºâ€œäº‹ä»¶å±‚è¯­ä¹‰â€ï¼Œä½†å£°éŸ³æœ¬èº«è¿˜æ˜¯ç”¨ WebAudio åˆæˆ/æ¸²æŸ“æ›´ç¨³ã€‚

---

# æ¶æ„ä¸äº¤äº’è¦ç‚¹

* **ä¸€æ¬¡æ€§è§£é” AudioContext**ï¼šç¬¬ä¸€æ¬¡ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»/é”®ç›˜ï¼‰æ—¶ `ctx.resume()`ï¼Œåç»­ hover æ‰èƒ½é›¶å»¶è¿Ÿå‡ºå£°ï¼ˆChrome æ”¿ç­–ï¼‰ã€‚
* **é¢„æ„å»ºâ€œæ€»çº¿â€**ï¼šå»ºç«‹å…¨å±€ `masterBus` â†’ `reverbSend` / `delaySend`ï¼Œæ¯ä¸ªâ€œéŸ³ç¬¦/äº‹ä»¶â€åªåˆ›å»ºè½»é‡â€œéŸ³æº+åŒ…ç»œ+æ»¤æ³¢â€ï¼Œæ··å“/å»¶æ—¶èµ° Sendï¼Œå°¾éŸ³è‡ªç„¶æ”¶æŸä¸”ä¸ä¼šè¢«æ‰“æ–­ã€‚
* **è°ƒåº¦**ï¼šç”¨ Tone.Transportï¼ˆæˆ–è‡ªå·±åš lookahead è°ƒåº¦ï¼‰é˜²æ­¢é¢‘ç¹ hover æŠ–åŠ¨ï¼›ç»™åŒä¸€ Tab è®¾ç½®**æœ€çŸ­é‡è§¦å‘é—´éš”**å’Œ\*\*éšæœºå¾®å°éŸ³é«˜åç§»ï¼ˆÂ±10\~20centï¼‰\*\*å¢å¼ºè‡ªç„¶åº¦ã€‚
* **éŸ³è‰²ç­–ç•¥**ï¼š

  * èµ„è®¯/æ–‡æ¡£ç±» Tabï¼š**æŸ”å’Œçš„ FM/AM åˆæˆ**ï¼ˆAMSynth/FMSynthï¼‰ï¼ŒçŸ­é‡ŠéŸ³ + è½»å¾® plate reverbã€‚
  * åª’ä½“/åˆ›æ„ç±»ï¼š**Pluck/è†œç‰‡ç±»**ï¼ˆPluckSynth + å°‘è®¸å»¶æ—¶ï¼‰ã€‚
  * ç³»ç»Ÿ/è®¾ç½®ç±»ï¼š**Sub + çŸ­è„‰å†²**ï¼ˆä½é¢‘æç¤ºï¼Œä¸åˆºè€³ï¼‰ã€‚
* **å¯æ‰©å±•**ï¼šæŒ‰åŸŸåï¼ˆhost hashï¼‰â†’ æ˜ å°„åˆ°å›ºå®šè°ƒå¼/éŸ³é˜¶ï¼ˆå¦‚ C å¤§è°ƒ/äº”å£°éŸ³é˜¶ï¼‰ä¸ä¹å™¨é¢„è®¾ï¼›ç”¨æˆ·å¯åœ¨è®¾ç½®é¡µè°ƒæ•´**å¼ºåº¦**ï¼ˆsend levelï¼‰ã€**ç©ºé—´æ„Ÿ**ï¼ˆreverb mixï¼‰ã€**é•¿åº¦**ï¼ˆreleaseï¼‰ã€‚

---

# æœ€å°å¯ç”¨å®ç°ï¼ˆTone.js æ€è·¯ï¼‰

> ä»…ç¤ºæ„å…³é”®ç»“æ„ï¼šåˆæˆå™¨æ±  + æ•ˆæœæ€»çº¿ + è§¦å‘å‡½æ•°ã€‚å¯ç›´æ¥æ”¾åˆ°æ‰©å±•çš„èƒŒæ™¯æˆ– service worker + content çš„æ¡¥æ¥ä¸­ã€‚

```javascript
// audio/engine.js
import * as Tone from "tone";

let inited = false;
const buses = {};
const synthPool = [];

export async function initAudio() {
  if (inited) return;
  await Tone.start(); // éœ€ç”¨æˆ·é¦–æ¬¡äº¤äº’è§¦å‘
  // å…¨å±€æ€»çº¿
  buses.master = new Tone.Channel({ volume: -12 }).toDestination();
  buses.reverb = new Tone.Reverb({ decay: 2.2, preDelay: 0.02, wet: 0.25 }).connect(buses.master);
  buses.delay  = new Tone.FeedbackDelay({ delayTime: 0.18, feedback: 0.22, wet: 0.18 }).connect(buses.master);

  // è½»é‡åˆæˆå™¨æ± ï¼ˆå¤šéŸ³é˜²å¡é¡¿ï¼‰
  for (let i = 0; i < 8; i++) {
    const synth = new Tone.AMSynth({
      harmonicity: 1.5,
      modulationIndex: 2,
      envelope: { attack: 0.002, decay: 0.12, sustain: 0.1, release: 0.25 },
      modulationEnvelope: { attack: 0.001, decay: 0.08, sustain: 0.05, release: 0.2 }
    });
    // æ¯ä¸ªéŸ³æºéƒ½æœ‰ä¸¤ä¸ªå‘é€ï¼šreverb/delay
    const toBus = new Tone.Channel();
    toBus.fan(buses.reverb, buses.delay, buses.master);
    synth.connect(toBus);
    synthPool.push(synth);
  }
  inited = true;
}

let idx = 0;
function nextSynth() { const s = synthPool[idx++ % synthPool.length]; return s; }

const pentatonic = ["C4","D4","E4","G4","A4","C5","D5","E5"];
function pickNoteFromHost(host) {
  // ç¨³å®šå¯é‡å¤çš„â€œåŸŸåâ†’éŸ³é«˜â€æ˜ å°„
  let h = 0; for (const c of host) h = (h*131 + c.charCodeAt(0)) >>> 0;
  return pentatonic[h % pentatonic.length];
}

export function setGlobalMix({wetReverb, wetDelay, masterGainDb}) {
  if (wetReverb != null) buses.reverb.wet.value = wetReverb;
  if (wetDelay != null)  buses.delay.wet.value  = wetDelay;
  if (masterGainDb != null) buses.master.volume.value = masterGainDb;
}

let lastPlay = 0;
export function playHover(host, intensity=1.0) {
  if (!inited) return;
  const now = Tone.now();
  // æœ€çŸ­é‡è§¦å‘é—´éš”ï¼ˆæŠ–åŠ¨ä¿æŠ¤ï¼‰
  if (now - lastPlay < 0.06) return;
  lastPlay = now;

  const note = pickNoteFromHost(host);
  const s = nextSynth();

  // è½»å¾®éšæœºåŒ–é¿å…â€œæœºæ¢°æ„Ÿâ€
  const detune = (Math.random() * 20 - 10); // Â±10 cents
  s.detune.rampTo(detune, 0.005);

  // å¼ºåº¦æ§åˆ¶ï¼šåŒæ—¶ä½œç”¨äºéŸ³é‡ä¸é‡Šæ”¾
  const vel = Math.min(1, Math.max(0.2, 0.6 * intensity));
  const dur = Math.min(0.6, 0.15 + 0.25 * intensity);

  s.triggerAttackRelease(note, dur, now, vel);
}
```

ä½¿ç”¨æ–¹å¼ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```javascript
// content.js
import { initAudio, playHover, setGlobalMix } from "./audio/engine.js";

document.addEventListener("click", async () => { await initAudio(); }); // é¦–æ¬¡è§£é”
document.querySelectorAll(".tab-like").forEach(el => {
  el.addEventListener("mouseenter", () => {
    const host = el.dataset.host ?? location.host;
    playHover(host, /* intensity from UI or heuristics */ 0.8);
  });
});

// ç”¨æˆ·è®¾ç½®æ˜ å°„åˆ°æ€»çº¿
setGlobalMix({ wetReverb: 0.2, wetDelay: 0.1, masterGainDb: -10 });
```

> æƒ³è¦æ›´â€œç©ºé—´çœŸå®æ„Ÿâ€ï¼ŒæŠŠ `Tone.Reverb` æ¢æˆ **Convolver** + ä½“ç§¯æå°çš„ IRï¼ˆæ¯”å¦‚ 10â€“50KB çš„ plate/roomï¼‰ï¼Œè´¨æ„Ÿä¼šæ˜¾è‘—æå‡ã€‚

---

# å¦‚æœä½ åšæŒèµ° â€œMIDI æ€è·¯â€

* **äº‹ä»¶å±‚**ï¼šæŠŠâ€œTab äº¤äº’â€æ˜ å°„æˆ MIDI NoteOn/NoteOffï¼ˆéŸ³é«˜=åŸŸåæ˜ å°„ï¼ŒåŠ›åº¦=åœç•™æ—¶é•¿/é‡è¦æ€§ï¼‰ã€‚
* **æ¸²æŸ“å±‚**ï¼šåœ¨æœ¬åœ°ç”¨ **SoundFont æ’­æ”¾å™¨ï¼ˆWebAudioFont / soundfont-playerï¼‰** æˆ– Tone.js åˆæˆå™¨æ¥æ”¶äº‹ä»¶ï¼›ä¸è¦ä¾èµ–å¤–éƒ¨ MIDI è®¾å¤‡ï¼ˆWebMIDI æƒé™ç¹çä¸”ä¸å¯æ§ï¼‰ã€‚
* **ä¼˜ç‚¹**ï¼šè¯­ä¹‰æ¸…æ™°ï¼Œå¯åç»­å¯¼å‡º/å›æ”¾â€œç”¨æˆ·ä¸€å¤©çš„æµè§ˆäº¤å“æ›²â€ğŸ˜„ã€‚
* **ç¼ºç‚¹**ï¼šç›¸æ¯”ç›´æ¥ç”¨ Tone.jsï¼Œå¤šä¸€å±‚å·¥å…·é“¾ä¸”éŸ³è‰²è´¨é‡è¿˜å–å†³äº SoundFont ä½“ç§¯ã€‚

---

# æ€§èƒ½ä¸å®¡æ ¸æ³¨æ„ç‚¹ï¼ˆChrome Web Storeï¼‰

* **ä½“ç§¯æ§åˆ¶**ï¼šé¿å…å¤§ SoundFontï¼›æ··å“ç”¨å° IRï¼›åˆæˆä¼˜å…ˆäºé‡‡æ ·ã€‚
* **åŠŸè€—**ï¼šä¿æŒ **å•ä¸ª AudioContext** ä¸å…±äº«æ•ˆæœæ€»çº¿ï¼›ç©ºé—²æ—¶æš‚åœè°ƒåº¦ï¼›é™åˆ¶æœ€å¤§å¹¶å‘éŸ³ç¬¦ã€‚
* **å¯è®¿é—®æ€§**ï¼šæä¾›â€œä¸€é”®é™éŸ³â€å’ŒéŸ³é‡æ»‘æ†ï¼›å°Šé‡ç³»ç»Ÿâ€œç®€åŒ–åŠ¨ç”»/å‡å°‘åŠ¨æ•ˆâ€åå¥½ã€‚
* **äº¤äº’é—¨æ§›**ï¼šé¦–æ¬¡éœ€ç”¨æˆ·ç‚¹å‡»è§£é”éŸ³é¢‘ï¼Œhover æ‰èƒ½å³æ—¶å‡ºå£°ï¼ˆç­–ç•¥è¦æ±‚ï¼‰ã€‚
* **ä¸è¿‡åº¦æ‰“æ‰°**ï¼šä¸ºé¢‘ç¹ hover è®¾ç½®èŠ‚æµä¸éšæœºå˜åŒ–ï¼Œé¿å…â€œå“’å“’å“’â€å¯†é›†å™ªå£°ã€‚

---

# å°ç»“

* **æ›´ä¼˜é›…** â‰  å¿…é¡» MIDIã€‚å¯¹æµè§ˆå™¨æ‰©å±•è€Œè¨€ï¼Œ**Tone.js / åŸç”Ÿ WebAudio** æ˜¯â€œè½»é‡ + å¯æ§ + éŸ³è´¨å¥½â€çš„æœ€ä½³å¹³è¡¡ã€‚
* é€šè¿‡**åˆæˆå™¨ + æ•ˆæœæ€»çº¿ + äº‹ä»¶è°ƒåº¦**ï¼Œä½ èƒ½å¾—åˆ°ï¼šæ³›éŸ³ã€å»¶æ—¶ã€æ··å“ã€åŒ…ç»œã€ç”šè‡³å¾®å¦™çš„éŸ³è‰²ä¸ªæ€§ï¼Œè€Œä¸éœ€è¦å † WAVã€‚
* å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠä¸Šé¢çš„ç¤ºä¾‹æ‰©æˆ**å®Œæ•´å¯ç”¨çš„æœ€å°æ‰©å±•**ï¼ˆbackground + content + options UIï¼‰ï¼Œå¹¶æŠŠâ€œå¼ºåº¦æ§åˆ¶â€æ¥åˆ°ä½ çš„å¤©æ°”/çŠ¶æ€ API ä¸Šï¼Œåšæˆâ€œæƒ…å¢ƒè‡ªé€‚åº”çš„å£°æ™¯â€ã€‚
